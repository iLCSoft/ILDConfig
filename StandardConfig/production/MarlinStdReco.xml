<!-- 
  Top level Marlin steering file defining the ILD reconstruction chain.
  
  Mandatory parameters :
    * --constant.lcgeo_DIR : the lcgeo directory must point on the one sourced in your current ilcsoft
    * --constant.DetectorModel : the detector model to use the pre-defined lcgeo_DIR as ${lcgeo_DIR}/ILD/compact/${DetectorModel}/${DetectorModel}.xml
    * --global.LCIOInputFiles : The input lcio input file(s)
  
  Optional parameters :
    * --constant.OverlayEnergy : the center of mass energy for the overlay background. Must be one of these values : 250, 350, 500, 1000. By default, nothing is run (Empty) 
    * --constant.OverlayWWFiles (OverlayWBFiles, OverlayBWFiles or OverlayBBFiles) : The gamma gamma overlay background files names. These input file names become madatory as soon as the constant OverlayEnergy is set
    * --constant.PandoraSettingsFile : The pandora settings file to use (default is PandoraSettings/PandoraSettingsDefault.xml)
    * --constant.PidPDFFile : A single root file name for the PID likelihood processor
    * --constant.PidWeightFiles : A list (space separated) of XML files containing weights for low momentum pi/mu separation (from TMVA)

  Author : Remi Ete, DESY
-->


<marlin>
  <constants>
    <!-- ***** Global constant for reconstruction ***** -->
    <!-- The lcgeo directory where to look for the ILD model -->
    <constant name="lcgeo_DIR" value="/cvmfs/ilc.desy.de/sw/x86_64_gcc49_sl6/v01-19-04/lcgeo/v00-13-04" />
    <!-- ILD detector model -->
    <constant name="DetectorName" value="ILD_l4_o1_v02" />
    <!-- The full compact file name -->
    <constant name="CompactFile" value="${lcgeo_DIR}/ILD/compact/${DetectorName}/${DetectorName}.xml" />
    <!-- ILD calibration file -->
    <constant name="CalibrationFile" value="Calibration/Calibration_${DetectorName}.xml" />
  
    <!-- CMS energy for overlay background -->
    <!-- WARNING : By setting this energy, you must ensure that the overlay files are set in the following  -->
    <constant name="OverlayEnergy" value="Empty" />
  
    <!-- ***** Input files constants ***** -->
    <!-- Pandora settings file -->
    <constant name="PandoraSettingsFile" value="PandoraSettings/PandoraSettingsDefault.xml" />
    <!-- Overlay background files. Must be specified if the OverlayEnergy constant is set (not Empty) -->
    <constant name="OverlayWWFiles">  </constant>
    <constant name="OverlayWBFiles">  </constant>
    <constant name="OverlayBWFiles">  </constant>
    <constant name="OverlayBBFiles">  </constant>
    <!-- Special Beamcal overlay background file -->
    <constant name="BeamCalBackgroundFile" value="HighLevelReco/BeamCalBackground/BeamCal_bg_E500-TDR_ws.root" />
    <!-- Particle identification PDF root file -->
    <constant name="PidPDFFile" value="HighLevelReco/PIDFiles/LikelihoodPID_Histogram_v01.root" />
    <!-- Particle identification BDT weights file for low momemtum mu/pi separation -->
    <constant name="PidWeightFiles">
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_02GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_03GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_04GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_05GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_06GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_07GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_08GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_09GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_10GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_11GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_12GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_13GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_14GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_15GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_16GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_17GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_18GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_19GeVP_clusterinfo.weights.xml
      HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_20GeVP_clusterinfo.weights.xml
    </constant>
    
    <!-- Calibration constants from external file -->
    <include ref="${CalibrationFile}" />
    
    <!-- Output files constants -->
    <constant name="OutputBaseName" value="StandardReco" />
    <constant name="AIDAFileName" value="${OutputBaseName}_AIDA" />
    <constant name="RECOutputFile" value="${OutputBaseName}_REC.slcio" />
    <constant name="DSTOutputFile" value="${OutputBaseName}_DST.slcio" />
    <constant name="PfoOutputFile" value="${OutputBaseName}_PfoAnalysis.root" />
  </constants>
  
  
  <!-- ***** Execute section ***** -->
  <execute>
    <!-- Initialization processors -->
    <group name="Init" />
    <!-- Overlay background (if any) -->
    <group name="BgOverlay" />
    <!-- Tracking digitizers -->
    <group name="TrackingDigi" />
    <!-- Tracking reconstruction -->
    <group name="TrackingReco" />
    <!-- Ecal digitizers -->
    <group name="EcalDigi" />
    <!-- Hcal digitizers -->
    <group name="HcalDigi" />
    <!-- Fcal digitizers -->
    <group name="FcalDigi" />
    <!-- Muon digitizer(s) -->
    <group name="MuonDigi" />
    <!-- Particle flow reconstruction -->
    <group name="ParticleFlow" />
    <!-- High level reconstruction -->
    <group name="HighLevelReco" />
    <!-- Output processors -->
    <group name="Output" />
  </execute>
  
  <!-- ***** Global section ***** -->
  <global>
    <parameter name="LCIOInputFiles"> </parameter>
    <parameter name="GearXMLFile" value="Gear/gear_${DetectorName}.xml"/>
    <parameter name="MaxRecordNumber" value="0"/>
    <parameter name="SkipNEvents" value="0"/>
    <parameter name="SupressCheck" value="false"/>
    <parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> MESSAGE </parameter>
    <parameter name="RandomSeed" value="1234567890" />
    <parameter name="OutputSteeringFile" value="MarlinStdRecoParsed.xml"/>
  </global>
  
  <!-- Init processors : histograming, logging, geometry ... -->
  <include ref="Init/Init.xml" />

  <!-- Overlay background -->
  <include ref="Overlay/Overlay${OverlayEnergy}.xml" />
  
  <!-- Tracking related : digitization, reconstruction -->
  <include ref="Tracking/TrackingDigi.xml" />
  <include ref="Tracking/TrackingReco.xml" />
  
  <!-- Calorimeter digitization : Ecal, Hcal, Fcal and Muon -->
  <include ref="CaloDigi/${EcalTechnology}Digi.xml" />
  <include ref="CaloDigi/${HcalTechnology}Digi.xml" />
  <include ref="CaloDigi/FcalDigi.xml" />
  <include ref="CaloDigi/MuonDigi.xml" />
  
  <!-- Particle Flow reconstruction : PandoraPFA -->
  <include ref="ParticleFlow/PandoraPFA.xml" />

  <!-- Post reconstruction related : PID, Vertexing, Particle finding, cluster topology -->
  <include ref="HighLevelReco/HighLevelReco.xml" />
  
  <!-- Write reconstruction output : REC, DST and PfoAnalysis -->
  <include ref="Output/Output.xml" />
  
</marlin>